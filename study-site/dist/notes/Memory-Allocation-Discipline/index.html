<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <meta name="description" content="Senior .NET study guide for Memory Allocation Discipline" />
  <meta name="theme-color" content="#0f172a" />
  <title>Memory Allocation Discipline | C# Interview Prep Cheat Sheet</title>
  <link rel="manifest" href="..\..\assets/manifest.webmanifest" />
  <script>
    (() => {
      const supported = ['midnight', 'light', 'dark'];
      const saved = sessionStorage.getItem('study-theme');
      const fallback = 'light';
      const initial = supported.includes(saved) ? saved : fallback;
      document.documentElement.dataset.theme = initial;
      window.__studyTheme = initial;
    })();
  </script>
  <link rel="stylesheet" href="..\..\assets/styles.css" />
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism-tomorrow.min.css" />
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap" rel="stylesheet">
</head>
<body>
  <header class="site-header">
    <div>
      <p class="eyebrow">C# Interview Prep</p>
      <h1>Senior .NET Study Portal</h1>
      <p class="subtitle">Ultimate cheat sheets, patterns, and interview-ready scenarios in one place.</p>
    </div>
    <div class="header-actions">
      <div class="theme-switcher" aria-label="Theme selector">
        <label for="theme-select" class="theme-label">Theme</label>
        <select id="theme-select" class="theme-select">
          <option value="midnight">Current</option>
          <option value="light">Light</option>
          <option value="dark">Dark</option>
        </select>
      </div>
      <div class="badge">Fast recall</div>
    </div>
  </header>
  <div class="layout">
    <nav class="sidebar">
      <div class="sidebar-section">
        <h2>Navigation</h2>
        <div class="search-hint">Use Ctrl/Cmd + F for quick lookup</div>
        <div class="sidebar-scroll"><div class="nav-groups"><div class="sidebar-group" data-group="notes">
      <button class="sidebar-group__header" type="button" aria-expanded="false">
        <span>Notes</span>
        <span class="chevron" aria-hidden="true"></span>
      </button>
      <ul class="sidebar-group__items" hidden><li><a class="nav-link" href="..\../notes/core-concepts.html">Core Concepts</a></li><li><a class="nav-link" href="..\../notes/error-handling.html">Error Handling</a></li><li><a class="nav-link" href="..\../notes/logging.html">Logging</a></li><li><a class="nav-link" href="..\../notes/testing-strategies.html">Testing Strategies</a></li></ul>
    </div><div class="sidebar-group" data-group="notes-automapper">
      <button class="sidebar-group__header" type="button" aria-expanded="false">
        <span>Notes / Automapper</span>
        <span class="chevron" aria-hidden="true"></span>
      </button>
      <ul class="sidebar-group__items" hidden><li><a class="nav-link" href="..\../notes/Automapper/AutoMapper.html">AutoMapper</a></li></ul>
    </div><div class="sidebar-group" data-group="notes-big-o-complexity">
      <button class="sidebar-group__header" type="button" aria-expanded="false">
        <span>Notes / Big O Complexity</span>
        <span class="chevron" aria-hidden="true"></span>
      </button>
      <ul class="sidebar-group__items" hidden><li><a class="nav-link" href="..\../notes/Big-O-Complexity/index.html">Big O Complexity</a></li><li><a class="nav-link" href="..\../notes/Big-O-Complexity/O1-Constant-Time.html">O1 Constant Time</a></li><li><a class="nav-link" href="..\../notes/Big-O-Complexity/OLogN-Logarithmic-Time.html">OLogN Logarithmic Time</a></li><li><a class="nav-link" href="..\../notes/Big-O-Complexity/ON-Linear-Time.html">ON Linear Time</a></li><li><a class="nav-link" href="..\../notes/Big-O-Complexity/ON2-Quadratic-Time.html">ON2 Quadratic Time</a></li><li><a class="nav-link" href="..\../notes/Big-O-Complexity/ONLogN-Linearithmic-Time.html">ONLogN Linearithmic Time</a></li><li><a class="nav-link" href="..\../notes/Big-O-Complexity/Space-Complexity.html">Space Complexity</a></li></ul>
    </div><div class="sidebar-group" data-group="notes-clean-architecture">
      <button class="sidebar-group__header" type="button" aria-expanded="false">
        <span>Notes / Clean Architecture</span>
        <span class="chevron" aria-hidden="true"></span>
      </button>
      <ul class="sidebar-group__items" hidden><li><a class="nav-link" href="..\../notes/Clean-Architecture/index.html">Clean Architecture</a></li></ul>
    </div><div class="sidebar-group" data-group="notes-collections-and-enumerables">
      <button class="sidebar-group__header" type="button" aria-expanded="false">
        <span>Notes / Collections And Enumerables</span>
        <span class="chevron" aria-hidden="true"></span>
      </button>
      <ul class="sidebar-group__items" hidden><li><a class="nav-link" href="..\../notes/Collections-And-Enumerables/index.html">Collections And Enumerables</a></li><li><a class="nav-link" href="..\../notes/Collections-And-Enumerables/ICollection.html">ICollection</a></li><li><a class="nav-link" href="..\../notes/Collections-And-Enumerables/IEnumerable.html">IEnumerable</a></li><li><a class="nav-link" href="..\../notes/Collections-And-Enumerables/IList.html">IList</a></li><li><a class="nav-link" href="..\../notes/Collections-And-Enumerables/IQueryable.html">IQueryable</a></li><li><a class="nav-link" href="..\../notes/Collections-And-Enumerables/IReadOnly.html">IReadOnly</a></li></ul>
    </div><div class="sidebar-group" data-group="notes-design-patterns">
      <button class="sidebar-group__header" type="button" aria-expanded="false">
        <span>Notes / Design Patterns</span>
        <span class="chevron" aria-hidden="true"></span>
      </button>
      <ul class="sidebar-group__items" hidden><li><a class="nav-link" href="..\../notes/Design-Patterns/CQRS Pattern.html">CQRS Pattern</a></li><li><a class="nav-link" href="..\../notes/Design-Patterns/Decorator Pattern.html">Decorator Pattern</a></li><li><a class="nav-link" href="..\../notes/Design-Patterns/Factory Pattern.html">Factory Pattern</a></li><li><a class="nav-link" href="..\../notes/Design-Patterns/Mediator Pattern.html">Mediator Pattern</a></li><li><a class="nav-link" href="..\../notes/Design-Patterns/Observer Pattern.html">Observer Pattern</a></li><li><a class="nav-link" href="..\../notes/Design-Patterns/Strategy Pattern.html">Strategy Pattern</a></li></ul>
    </div><div class="sidebar-group" data-group="notes-dry">
      <button class="sidebar-group__header" type="button" aria-expanded="false">
        <span>Notes / DRY</span>
        <span class="chevron" aria-hidden="true"></span>
      </button>
      <ul class="sidebar-group__items" hidden><li><a class="nav-link" href="..\../notes/DRY/index.html">DRY</a></li></ul>
    </div><div class="sidebar-group" data-group="notes-fluentvalidation">
      <button class="sidebar-group__header" type="button" aria-expanded="false">
        <span>Notes / FluentValidation</span>
        <span class="chevron" aria-hidden="true"></span>
      </button>
      <ul class="sidebar-group__items" hidden><li><a class="nav-link" href="..\../notes/FluentValidation/FluentValidation.html">FluentValidation</a></li></ul>
    </div><div class="sidebar-group is-open" data-group="notes-memory-allocation-discipline">
      <button class="sidebar-group__header" type="button" aria-expanded="true">
        <span>Notes / Memory Allocation Discipline</span>
        <span class="chevron" aria-hidden="true"></span>
      </button>
      <ul class="sidebar-group__items"><li><a class="nav-link active" href="..\../notes/Memory-Allocation-Discipline/index.html">Memory Allocation Discipline</a></li><li><a class="nav-link" href="..\../notes/Memory-Allocation-Discipline/Memory Allocation Discipline Example.html">Memory Allocation Discipline Example</a></li><li><a class="nav-link" href="..\../notes/Memory-Allocation-Discipline/Memory Allocation Discipline Example Async.html">Memory Allocation Discipline Example Async</a></li></ul>
    </div><div class="sidebar-group" data-group="notes-solid">
      <button class="sidebar-group__header" type="button" aria-expanded="false">
        <span>Notes / SOLID</span>
        <span class="chevron" aria-hidden="true"></span>
      </button>
      <ul class="sidebar-group__items" hidden><li><a class="nav-link" href="..\../notes/SOLID/D-Dependency-Inversion-Principle-DIP.html">D Dependency Inversion Principle DIP</a></li><li><a class="nav-link" href="..\../notes/SOLID/I-Interface-Segregation-Principle-ISP.html">I Interface Segregation Principle ISP</a></li><li><a class="nav-link" href="..\../notes/SOLID/L-Liskov-Substitution-Principle-LSP.html">L Liskov Substitution Principle LSP</a></li><li><a class="nav-link" href="..\../notes/SOLID/O-Open-Closed-Principle-OCP.html">O Open Closed Principle OCP</a></li><li><a class="nav-link" href="..\../notes/SOLID/S-Single-Responsibility-Principle-SRP.html">S Single Responsibility Principle SRP</a></li><li><a class="nav-link" href="..\../notes/SOLID/index.html">SOLID</a></li></ul>
    </div><div class="sidebar-group" data-group="notes-sub-notes">
      <button class="sidebar-group__header" type="button" aria-expanded="false">
        <span>Notes / Sub Notes</span>
        <span class="chevron" aria-hidden="true"></span>
      </button>
      <ul class="sidebar-group__items" hidden><li><a class="nav-link" href="..\../notes/sub-notes/Async Await Deep Dive.html">Async Await Deep Dive</a></li><li><a class="nav-link" href="..\../notes/sub-notes/base-keyword.html">Base Keyword</a></li><li><a class="nav-link" href="..\../notes/sub-notes/CLR & Garbage Collector (GC).html">CLR & Garbage Collector (GC)</a></li><li><a class="nav-link" href="..\../notes/sub-notes/CLR & Garbage Collector (GC) Practical Example.html">CLR & Garbage Collector (GC) Practical Example</a></li><li><a class="nav-link" href="..\../notes/sub-notes/Dependency Injection Lifetimes.html">Dependency Injection Lifetimes</a></li><li><a class="nav-link" href="..\../notes/sub-notes/FIFO Queues in .NET.html">FIFO Queues In .NET</a></li><li><a class="nav-link" href="..\../notes/sub-notes/Forcing Garbage Collection.html">Forcing Garbage Collection</a></li><li><a class="nav-link" href="..\../notes/sub-notes/IDisposable Patterns.html">IDisposable Patterns</a></li><li><a class="nav-link" href="..\../notes/sub-notes/nameof-keyword.html">Nameof Keyword</a></li><li><a class="nav-link" href="..\../notes/sub-notes/NET Generational Garbage Collection (GC) Deep Dive.html">NET Generational Garbage Collection (GC) Deep Dive</a></li><li><a class="nav-link" href="..\../notes/sub-notes/RabbitMQ.html">RabbitMQ</a></li><li><a class="nav-link" href="..\../notes/sub-notes/Reflection Overview.html">Reflection Overview</a></li><li><a class="nav-link" href="..\../notes/sub-notes/Server vs Workstation GC.html">Server Vs Workstation GC</a></li><li><a class="nav-link" href="..\../notes/sub-notes/Sorted Collections Interview Notes.html">Sorted Collections Interview Notes</a></li><li><a class="nav-link" href="..\../notes/sub-notes/Sorting Algorithms.html">Sorting Algorithms</a></li><li><a class="nav-link" href="..\../notes/sub-notes/struct vs class when to use which.html">Struct Vs Class When To Use Which</a></li><li><a class="nav-link" href="..\../notes/sub-notes/types.html">Types</a></li></ul>
    </div><div class="sidebar-group" data-group="notes-use-cases-massive-traffic">
      <button class="sidebar-group__header" type="button" aria-expanded="false">
        <span>Notes / Use Cases / Massive Traffic</span>
        <span class="chevron" aria-hidden="true"></span>
      </button>
      <ul class="sidebar-group__items" hidden><li><a class="nav-link" href="..\../notes/Use-Cases/massive-traffic/01-async-patterns.html">01 Async Patterns</a></li><li><a class="nav-link" href="..\../notes/Use-Cases/massive-traffic/02-backpressure-rate-limiting.html">02 Backpressure Rate Limiting</a></li><li><a class="nav-link" href="..\../notes/Use-Cases/massive-traffic/03-caching-strategies.html">03 Caching Strategies</a></li><li><a class="nav-link" href="..\../notes/Use-Cases/massive-traffic/04-database-scaling.html">04 Database Scaling</a></li><li><a class="nav-link" href="..\../notes/Use-Cases/massive-traffic/05-message-queues.html">05 Message Queues</a></li><li><a class="nav-link" href="..\../notes/Use-Cases/massive-traffic/06-resilience-patterns.html">06 Resilience Patterns</a></li><li><a class="nav-link" href="..\../notes/Use-Cases/massive-traffic/07-observability.html">07 Observability</a></li><li><a class="nav-link" href="..\../notes/Use-Cases/massive-traffic/08-complete-example.html">08 Complete Example</a></li><li><a class="nav-link" href="..\../notes/Use-Cases/massive-traffic/index.html">Massive Traffic</a></li></ul>
    </div><div class="sidebar-group" data-group="practice">
      <button class="sidebar-group__header" type="button" aria-expanded="false">
        <span>Practice</span>
        <span class="chevron" aria-hidden="true"></span>
      </button>
      <ul class="sidebar-group__items" hidden><li><a class="nav-link" href="..\../practice/answers.html">Answers</a></li><li><a class="nav-link" href="..\../practice/csharp-system-design-questions.html">Csharp System Design Questions</a></li><li><a class="nav-link" href="..\../practice/questions.html">Questions</a></li></ul>
    </div><div class="sidebar-group" data-group="practice-real-exam-questions-answers">
      <button class="sidebar-group__header" type="button" aria-expanded="false">
        <span>Practice / Real Exam Questions Answers</span>
        <span class="chevron" aria-hidden="true"></span>
      </button>
      <ul class="sidebar-group__items" hidden><li><a class="nav-link" href="..\../practice/real exam questions answers/replace int without variable.html">Replace Int Without Variable</a></li><li><a class="nav-link" href="..\../practice/real exam questions answers/struct vs class questions and answers.html">Struct Vs Class Questions And Answers</a></li></ul>
    </div></div></div>
      </div>
    </nav>
    <main class="content">
      <article class="card">
        <div class="breadcrumbs">notes\Memory-Allocation-Discipline\index.md</div>
        <h2>Memory Allocation Discipline</h2>
        <div class="toc-label">Rapid overview</div>
        <div class="toc"><ul class="toc-list"><li class="level-1"><a href="#memory-allocation-discipline-in-net-deep-dive">üß† Memory Allocation Discipline in .NET ‚Äî Deep Dive</a></li><li class="level-2"><a href="#1-what-it-means">1Ô∏è‚É£ What it means</a></li><li class="level-2"><a href="#2-why-it-matters">2Ô∏è‚É£ Why it matters</a></li><li class="level-2"><a href="#3-common-allocation-traps-and-how-to-fix-them">3Ô∏è‚É£ Common allocation traps (and how to fix them)</a></li><li class="level-2"><a href="#4-reuse-patterns-that-eliminate-gc-churn">4Ô∏è‚É£ Reuse patterns that eliminate GC churn</a></li><li class="level-3"><a href="#object-pooling">‚úÖ **Object pooling**</a></li><li class="level-3"><a href="#buffer-pooling">‚úÖ **Buffer pooling**</a></li><li class="level-3"><a href="#string-interning-or-caching">‚úÖ **String interning or caching**</a></li><li class="level-3"><a href="#structs-and-value-types">‚úÖ **Structs and value types**</a></li><li class="level-3"><a href="#using-spant-memoryt-for-zero-copy">‚úÖ **Using `Span<T>` / `Memory<T>` for zero-copy**</a></li><li class="level-2"><a href="#5-avoiding-hidden-allocations">5Ô∏è‚É£ Avoiding hidden allocations</a></li><li class="level-2"><a href="#6-temporal-allocation-awareness-lifetime-patterns">6Ô∏è‚É£ Temporal allocation awareness (lifetime patterns)</a></li><li class="level-2"><a href="#7-measuring-validating-allocation-discipline">7Ô∏è‚É£ Measuring & validating allocation discipline</a></li><li class="level-2"><a href="#8-interview-ready-example-say-this-at">8Ô∏è‚É£ Interview-ready example (say this at)</a></li><li class="level-2"><a href="#9-trading-system-tie-in-concrete-example">9Ô∏è‚É£ Trading-system tie-in (concrete example)</a></li><li class="level-2"><a href="#10-tldr-summary-say-this-confidently">10Ô∏è‚É£ TL;DR Summary (say this confidently)</a></li><li class="level-2"><a href="#questions-answers">Questions & Answers</a></li></ul></div>
        <h1 id="memory-allocation-discipline-in-net-deep-dive">üß† Memory Allocation Discipline in .NET ‚Äî Deep Dive</h1>
<p>---</p>
<h2 id="1-what-it-means">1Ô∏è‚É£ What it means</h2>
<p><strong>Allocation discipline</strong> means designing your code so that you:</p>
<ul><li>Allocate <strong>only when necessary</strong></li><li><strong>Reuse</strong> what you already allocated</li><li><strong>Minimize copying</strong> of data</li><li>Keep <strong>object lifetimes short</strong> (so they die in Gen 0)</li><li>Prevent <strong>accidental heap allocations</strong> in tight loops or latency-sensitive paths</li></ul>
<p>Basically:</p>
<blockquote><p>‚ÄúDon‚Äôt let your code throw objects at the GC faster than it can clean them up.‚Äù</p></blockquote>
<p>---</p>
<h2 id="2-why-it-matters">2Ô∏è‚É£ Why it matters</h2>
<p>Allocations aren‚Äôt ‚Äúfree.‚Äù Each heap allocation:</p>
<p>(eventually promotions ‚Üí Gen 2 ‚Üí <strong>long pauses</strong>)</p>
<ul><li>Consumes CPU (for pointer bumping)</li><li>Increases memory footprint</li><li>Puts pressure on Gen 0 ‚Üí more GC cycles</li></ul>
<p>In <strong>low-latency systems</strong> (like trade execution or tick feeds), GC pauses = missed ticks or delayed quotes ‚Äî unacceptable.</p>
<p>So the best GC strategy is often:</p>
<blockquote><p>‚ÄúDon‚Äôt make the GC do work at all.‚Äù</p></blockquote>
<p>---</p>
<h2 id="3-common-allocation-traps-and-how-to-fix-them">3Ô∏è‚É£ Common allocation traps (and how to fix them)</h2>
<table><thead><tr><th>Bad Practice</th><th>Why it‚Äôs bad</th><th>Fix</th></tr></thead><tbody><tr><td>Using <code>new</code> objects inside tight loops</td><td>Floods Gen 0</td><td>Reuse pooled objects</td></tr><tr><td><code>string.Concat</code> or <code>+</code> in loops</td><td>Creates new string every time</td><td>Use <code>StringBuilder</code> or spans</td></tr><tr><td>LINQ in hot paths</td><td>Allocates enumerators, closures</td><td>Use <code>for</code> loops</td></tr><tr><td>Boxing value types</td><td>Allocates on heap</td><td>Use generics / avoid casting to <code>object</code></td></tr><tr><td>Repeatedly allocating buffers</td><td>LOH churn</td><td>Use <code>ArrayPool&lt;T&gt;</code></td></tr><tr><td>Returning large arrays</td><td>LOH growth</td><td>Reuse pooled arrays or slice spans</td></tr></tbody></table>
<p>---</p>
<h2 id="4-reuse-patterns-that-eliminate-gc-churn">4Ô∏è‚É£ Reuse patterns that eliminate GC churn</h2>
<h3 id="object-pooling">‚úÖ <strong>Object pooling</strong></h3>
<p>.NET has built-in pools for common cases:</p>
<pre class="language-csharp"><code class="language-csharp">using Microsoft.Extensions.ObjectPool;

var pool = ObjectPool.Create&lt;MyReusableObject&gt;();
var item = pool.Get();
// use item...
pool.Return(item);</code></pre>
<p>üí° Great for: serializers, parsers, <code>StringBuilder</code>s, temp containers.</p>
<p><strong>Example:</strong></p>
<pre class="language-csharp"><code class="language-csharp">var sb = StringBuilderCache.Acquire();
// build a string
var result = StringBuilderCache.GetStringAndRelease(sb);</code></pre>
<p>‚Üí zero allocations between calls.</p>
<p>---</p>
<h3 id="buffer-pooling">‚úÖ <strong>Buffer pooling</strong></h3>
<p>The <code>ArrayPool&lt;T&gt;</code> API lets you rent and return arrays instead of allocating new ones.</p>
<pre class="language-csharp"><code class="language-csharp">var pool = ArrayPool&lt;byte&gt;.Shared;
byte[] buffer = pool.Rent(1024);
// use it
pool.Return(buffer);</code></pre>
<p>üí° Use this for:</p>
<ul><li>I/O buffers</li><li>Network streams</li><li>Deserialization</li><li>Message batching</li></ul>
<p>üöÄ Benefit: Avoids <strong>Large Object Heap churn</strong> (LOH fragmentation) and constant GC pressure.</p>
<p>---</p>
<h3 id="string-interning-or-caching">‚úÖ <strong>String interning or caching</strong></h3>
<p>Instead of creating new string instances for common identifiers (e.g., ‚ÄúEURUSD‚Äù):</p>
<pre class="language-csharp"><code class="language-csharp">string symbol = string.Intern(&quot;EURUSD&quot;);</code></pre>
<p>Or better ‚Äî store common symbols in a static <code>Dictionary&lt;string, string&gt;</code> and reuse the reference.</p>
<p>---</p>
<h3 id="structs-and-value-types">‚úÖ <strong>Structs and value types</strong></h3>
<p>For small, immutable data (ticks, coordinates, etc.), use <strong>structs</strong>:</p>
<ul><li>Stored inline ‚Üí no GC tracking</li><li>Can live and die on the stack</li><li>No heap allocations for short-lived data</li></ul>
<pre class="language-csharp"><code class="language-csharp">readonly struct Tick
{
    public string Symbol { get; }
    public double Bid { get; }
    public double Ask { get; }
}</code></pre>
<p>But ‚ö†Ô∏è keep them <strong>small</strong> (‚â§ 16‚Äì32 bytes). Large structs hurt performance due to copy costs.</p>
<p>---</p>
<h3 id="using-spant-memoryt-for-zero-copy">‚úÖ <strong>Using <code>Span&lt;T&gt;</code> / <code>Memory&lt;T&gt;</code> for zero-copy</strong></h3>
<p><code>Span&lt;T&gt;</code> and <code>Memory&lt;T&gt;</code> let you <strong>operate directly on existing memory</strong> ‚Äî without allocating new arrays or substrings.</p>
<p>Example: parsing a price line</p>
<pre class="language-csharp"><code class="language-csharp">ReadOnlySpan&lt;byte&gt; span = Encoding.ASCII.GetBytes(&quot;EURUSD,1.0743,1.0745&quot;);

int comma = span.IndexOf((byte)&#39;,&#39;);
var symbol = Encoding.ASCII.GetString(span[..comma]); // one allocation

Utf8Parser.TryParse(span[(comma + 1)..], out double bid, out _);</code></pre>
<p>No string splitting, no array allocations, no GC.</p>
<p>üí° <strong>Rule:</strong> Use <code>Span&lt;T&gt;</code> for synchronous parsing; <code>Memory&lt;T&gt;</code> when data crosses async boundaries.</p>
<p>---</p>
<h2 id="5-avoiding-hidden-allocations">5Ô∏è‚É£ Avoiding hidden allocations</h2>
<p>Even code that <em>looks innocent</em> can allocate. Some hidden examples:</p>
<table><thead><tr><th>Code</th><th>Hidden allocation</th></tr></thead><tbody><tr><td><code>foreach (var x in list)</code></td><td>Enumerator struct may box</td></tr><tr><td><code>async</code> methods</td><td>Allocates a state machine object</td></tr><tr><td><code>lambda</code> or <code>delegate</code> captures variable</td><td>Allocates closure object</td></tr><tr><td><code>ToString()</code></td><td>Often allocates new string</td></tr><tr><td><code>Task.FromResult(...)</code></td><td>Reuses task, good ‚úÖ</td></tr><tr><td><code>await</code> on <code>Task</code> that already completed</td><td>Allocates continuation unless optimized</td></tr></tbody></table>
<p>üí° Use tools like:</p>
<pre class="language-bash"><code class="language-bash">dotnet-trace collect --process-id &lt;pid&gt;
dotnet-counters monitor System.Runtime</code></pre>
<p>to watch <strong>Allocated Bytes/sec</strong>.</p>
<p>---</p>
<h2 id="6-temporal-allocation-awareness-lifetime-patterns">6Ô∏è‚É£ Temporal allocation awareness (lifetime patterns)</h2>
<p>The key to designing allocation-efficient systems is understanding <strong>lifetime scopes</strong>:</p>
<table><thead><tr><th>Lifetime</th><th>Strategy</th></tr></thead><tbody><tr><td><strong>Per-request</strong></td><td>Avoid allocations in controllers; reuse service-scoped resources</td></tr><tr><td><strong>Per-session</strong></td><td>Use dependency injection scopes for per-user data</td></tr><tr><td><strong>Global/static</strong></td><td>Cache immutable data, don‚Äôt recreate</td></tr><tr><td><strong>Transient</strong></td><td>Keep short-lived structs or pooled objects</td></tr></tbody></table>
<p>Example: in a market data service</p>
<ul><li>Buffer per connection (rented from pool)</li><li>Parser per connection (reused object)</li><li>Tick structs per message (stack-allocated)</li></ul>
<p>No GC churn in steady state.</p>
<p>---</p>
<h2 id="7-measuring-validating-allocation-discipline">7Ô∏è‚É£ Measuring & validating allocation discipline</h2>
<p>Use:</p>
<pre class="language-bash"><code class="language-bash">dotnet-counters monitor System.Runtime</code></pre>
<p>Watch:</p>
<pre class="language-csharp"><code class="language-csharp">Allocated Bytes/sec
Gen 0 GC Count
% Time in GC</code></pre>
<p>or use code:</p>
<pre class="language-csharp"><code class="language-csharp">Console.WriteLine(GC.GetTotalAllocatedBytes(true));</code></pre>
<p>‚úÖ Healthy pattern:</p>
<ul><li>High throughput with low Allocated Bytes/sec</li><li>Frequent Gen0, rare Gen1/2</li><li>% Time in GC < 2‚Äì3%</li></ul>
<p>---</p>
<h2 id="8-interview-ready-example-say-this-at">8Ô∏è‚É£ Interview-ready example (say this at)</h2>
<blockquote><p>‚ÄúAllocation discipline means being intentional about where and how you allocate. In latency-sensitive systems, even Gen0 collections matter. I use <code>ArrayPool&lt;T&gt;</code> and <code>ObjectPool&lt;T&gt;</code> to reuse memory, <code>Span&lt;T&gt;</code> for parsing binary and textual data, and avoid LINQ or string concatenation in tight loops. I measure Allocated Bytes/sec and Gen0 frequency in production to ensure the system stays allocation-stable. Our goal isn‚Äôt zero GC ‚Äî it‚Äôs <strong>predictable, bounded GC behavior</strong>.‚Äù</p></blockquote>
<p>---</p>
<h2 id="9-trading-system-tie-in-concrete-example">9Ô∏è‚É£ Trading-system tie-in (concrete example)</h2>
<p><strong>Without discipline:</strong></p>
<pre class="language-csharp"><code class="language-csharp">foreach (var msg in feed)
{
    var parts = msg.Split(&#39;,&#39;);
    var tick = new Tick(parts[0], double.Parse(parts[1]), double.Parse(parts[2]));
    Publish(tick);
}</code></pre>
<p>‚Üí Creates new string arrays, substrings, doubles ‚Üí Gen0/Gen1 churn.</p>
<p><strong>With discipline:</strong></p>
<pre class="language-csharp"><code class="language-csharp">byte[] buffer = ArrayPool&lt;byte&gt;.Shared.Rent(1024);
ReadOnlySpan&lt;byte&gt; span = buffer.AsSpan(0, bytesRead);
ParseTick(span);
ArrayPool&lt;byte&gt;.Shared.Return(buffer);</code></pre>
<p>‚Üí Zero heap allocations, predictable performance, stable GC profile.</p>
<p>---</p>
<h2 id="10-tldr-summary-say-this-confidently">10Ô∏è‚É£ TL;DR Summary (say this confidently)</h2>
<blockquote><p>‚ÄúAllocation discipline is about <strong>controlling your memory behavior</strong>. I design code to <strong>minimize heap allocations</strong>, <strong>reuse buffers</strong>, and <strong>operate directly on memory</strong> using <code>Span&lt;T&gt;</code> and <code>ArrayPool&lt;T&gt;</code>. That keeps the GC quiet, prevents Gen2 promotions, and delivers low-latency performance. In production, I watch GC metrics and tune allocation-heavy paths continuously.‚Äù</p></blockquote>
<p>---</p>
<p>Would you like me to show you <strong>a before-and-after microbenchmark</strong> example using <code>BenchmarkDotNet</code>, comparing naive allocation-heavy code vs pooled + span-based parsing? It‚Äôs an awesome way to explain ‚ÄúI don‚Äôt just know it ‚Äî I‚Äôve measured it.‚Äù</p>
<p>---</p>
<h2 id="questions-answers">Questions & Answers</h2>
<p><strong>Q: Why does allocation discipline matter for trading services?</strong></p>
<p>A: High-frequency workloads process millions of ticks per minute. Excess allocations trigger frequent GC cycles, inflating tail latency and risking missed market data. Disciplined allocation keeps GC quiet so SLAs stay predictable.</p>
<p><strong>Q: How do you decide when to optimize allocations?</strong></p>
<p>A: Profile first. Use BenchmarkDotNet or dotnet-trace to find hot spots with high allocated bytes/op. Only refactor critical paths‚Äîpremature optimization everywhere reduces readability.</p>
<p><strong>Q: What tools do you use to monitor allocations in production?</strong></p>
<p>A: <code>dotnet-counters monitor System.Runtime</code> for Allocated Bytes/sec, Prometheus/OpenTelemetry metrics, Azure App Insights, or PerfView ETW traces. Alert when allocations or GC pause time exceed thresholds.</p>
<p><strong>Q: How does <code>ArrayPool&lt;T&gt;</code> help avoid LOH pressure?</strong></p>
<p>A: Renting buffers from the shared pool reuses large arrays instead of allocating >85 KB objects per request, which would otherwise land on the LOH and cause expensive, fragmented Gen2 collections.</p>
<p><strong>Q: When would you choose structs over classes?</strong></p>
<p>A: For small immutable data (ticks, coordinates) that you pass frequently. Structs live inline/on the stack, so they avoid heap allocations and GC tracking. Keep them small (‚â§16 bytes) to minimize copy cost.</p>
<p><strong>Q: How do <code>Span&lt;T&gt;</code> and <code>Memory&lt;T&gt;</code> reduce allocations?</strong></p>
<p>A: They let you slice and parse existing buffers without creating new arrays or substrings. <code>Span&lt;T&gt;</code> stays within synchronous scopes; <code>Memory&lt;T&gt;</code> handles async flows while still pointing to the same backing buffer.</p>
<p><strong>Q: How do you avoid boxing in logging or metrics code?</strong></p>
<p>A: Use structured logging with value-type overloads or interpolated string handlers, keep APIs generic, and avoid casting to <code>object</code>. When necessary, wrap primitives in custom struct formatters or use spans.</p>
<p><strong>Q: How can <code>System.IO.Pipelines</code> improve allocation profile?</strong></p>
<p>A: Pipelines manage pooled buffers and expose <code>ReadOnlySequence&lt;T&gt;</code> so you can parse streaming data without copying. They also support backpressure and reduce per-message allocations vs manual <code>Stream.ReadAsync</code>.</p>
<p><strong>Q: What‚Äôs your approach to verifying improvements?</strong></p>
<p>A: Write microbenchmarks with <code>MemoryDiagnoser</code>, run load tests, and compare GC metrics before/after. Only merge when data shows lower allocations and stable latency.</p>
<p><strong>Q: How do you keep the team aligned on allocation discipline?</strong></p>
<p>A: Document guidelines (span usage, pooling patterns), add analyzers/tests for accidental allocations, and review PRs with perf instrumentation results so everyone understands the cost model.</p>
      </article>
    </main>
  </div>
  <footer class="footer">Built for disciplined study & interview drills.</footer>
  <script>
    (() => {
      const select = document.getElementById('theme-select');
      const supported = ['midnight', 'light', 'dark'];
      const saved = sessionStorage.getItem('study-theme');
      const fallback = 'light';
      const initial = supported.includes(saved) ? saved : (window.__studyTheme || fallback);
      document.documentElement.dataset.theme = initial;
      if (select) {
        select.value = initial;
        select.addEventListener('change', (event) => {
          const value = event.target.value;
          const next = supported.includes(value) ? value : fallback;
          document.documentElement.dataset.theme = next;
          sessionStorage.setItem('study-theme', next);
        });
      }
    })();
    (() => {
      const groups = document.querySelectorAll('.sidebar-group');
      if (!groups.length) return;
      const storageKey = 'study-open-groups';
      const saved = sessionStorage.getItem(storageKey);
      const openFromStorage = new Set(saved ? JSON.parse(saved) : []);

      const activeLink = document.querySelector('.nav-link.active');
      const activeGroup = activeLink?.closest('.sidebar-group');
      if (activeGroup?.dataset.group) {
        openFromStorage.add(activeGroup.dataset.group);
      }

      const syncStorage = () => {
        const openIds = Array.from(document.querySelectorAll('.sidebar-group.is-open'))
          .map((group) => group.dataset.group)
          .filter(Boolean);
        sessionStorage.setItem(storageKey, JSON.stringify(openIds));
      };

      const setExpanded = (group, expanded) => {
        const header = group.querySelector('.sidebar-group__header');
        const list = group.querySelector('.sidebar-group__items');
        group.classList.toggle('is-open', expanded);
        header?.setAttribute('aria-expanded', expanded);
        if (list) {
          list.hidden = !expanded;
        }
      };

      groups.forEach((group) => {
        const shouldOpen = openFromStorage.has(group.dataset.group);
        setExpanded(group, shouldOpen);
        const header = group.querySelector('.sidebar-group__header');
        header?.addEventListener('click', () => {
          const next = !group.classList.contains('is-open');
          setExpanded(group, next);
          syncStorage();
        });
      });
    })();
    if ('serviceWorker' in navigator) {
      window.addEventListener('load', () => {
        const swPath = '..\../service-worker.js';
        navigator.serviceWorker.register(swPath).catch((err) => {
          console.error('Service worker registration failed', err);
        });
      });
    }
  </script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/prism.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/components/prism-csharp.min.js"></script>
</body>
</html>